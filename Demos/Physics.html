<script src="../Hengine.js">
	title = "Hengine Demos - Physics";

	const BLOCK = new ElementScript("BLOCK", {
		init(l) {
			this.draw = () => null;
			l.color = Random.color();
		},
		draw(l, name, shape) {
			renderer.draw(l.color).rect(shape);
			renderer.stroke(Color.BLACK, 2).rect(shape);
		}
	});

	scene.mouseEvents = true;

	const THROWABLE = new ElementScript("THROWABLE", {
		init(l) {
			l.offset = Vector2.origin;
			l.thrown = false;
			l.scriptNumber = 2;
		},
		click(l, key, e) {
			l.thrown = true;
			l.offset = this.transform.globalSpaceToLocalSpace(e);
		},
		update(l) {
			if (mouse.justReleased("Left")) l.thrown = false;
			this.layer = +l.thrown;
			if (l.thrown) {
				const pos = this.transform.localSpaceToGlobalSpace(l.offset);
				let dif = mouse.world.minus(pos);
				dif.div(100);
				this.applyImpulseMass(pos, dif);
			}
		},
		escapeDraw(l) {
			if (l.thrown) {
				let start = this.transform.localSpaceToGlobalSpace(l.offset);
				let end = mouse.world.get();
				renderer.stroke(Color.RED, 2).arrow(start, end);
			}
		}
	});

	for (let i = 0; i < 50; i++) {
		const block = scene.main.addPhysicsRectElement("block", width / 2, height - (i + 1) * 40, 40 - i / 100, 40, true, new Controls("w", "s", "a", "d"), "No Tag");
		block.scripts.add(BLOCK);
		block.scripts.add(THROWABLE);
	}

	const floor = scene.main.addPhysicsRectElement("floor", width / 2, height, width, 100, false, new Controls("w", "s", "a", "d"), "No Tag");

	intervals.continuous(function (time) {
		renderer.draw(Color.BLACK).text(Font.Arial30, "Click and drag objects to throw them", 10, 10);
	}, IntervalFunction.AFTER_UPDATE);

	scene.physicsEngine.iterations = 5;
</script>