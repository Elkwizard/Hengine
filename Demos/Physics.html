<script src="../Hengine.js">
	title = "Hengine Demos - Physics";
	
	const BLOCK = new ElementScript("BLOCK", {
		init(l) {
			this.draw = () => null;
			l.color = Random.color();
		},
		draw(l, name, shape) {
			renderer.draw(l.color).rect(shape);
			renderer.stroke(Color.BLACK, 2).rect(shape);
		}
	});

	scene.mouseEvents = true;

	const THROWABLE = new ElementScript("THROWABLE", {
		init(l) {
			l.offset = Vector2.origin;
			l.thrown = false;
			l.scriptNumber = 2;
		},
		click(l, key, e) {
			l.thrown = true;
			l.offset = this.transform.worldSpaceToModelSpace(e);
		},
		update(l) {
			if (mouse.justReleased("Left")) l.thrown = false;
			this.layer = +l.thrown;
			if (l.thrown) {
				let dif = mouse.world.minus(this.transform.modelSpaceToWorldSpace(l.offset));
				dif.div(1000);
				this.applyImpulseMass(this.transform.position, dif);
			}
		},
		escapeDraw(l) {
			if (l.thrown) {
				let start = this.transform.modelSpaceToWorldSpace(l.offset);
				let end = mouse.world.get();
				renderer.stroke(Color.RED, 2).arrow(start, end);
			}
		}
	});
	
	for (let i = 0; i < 50; i++) {
		const block = scene.main.addPhysicsRectElement("block", width / 2, height - (i + 1) * 40, 40 - i / 100, 40, true, new Controls("w", "s", "a", "d"), "No Tag");
		BLOCK.addTo(block);
		THROWABLE.addTo(block);
	}

	const floor = scene.main.addPhysicsRectElement("floor", width / 2, height, width, 100, false, new Controls("w", "s", "a", "d"), "No Tag");

	mouse.onScroll.listen(dy => (dy < 0) ? scene.camera.zoomIn(0.2) : scene.camera.zoomOut(0.2));



	intervals.continuous(function (time) {
		renderer.draw(Color.BLACK).text(Font.Arial30, "Use the mouse wheel to zoom\nClick and drag objects to throw them", 10, 10);
	}, IntervalFunction.AFTER_UPDATE);

	scene.physicsEngine.iterations = 3;
	scene.physicsEngine.sleepDuration = Infinity;
</script>